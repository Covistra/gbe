doctype 5
html
  head
    meta(name='viewport', content="width=device-width, initial-scale=1.0, user-scalable=no")
    meta(name="apple-mobile-web-app-capable", content="yes")
    meta(name="apple-mobile-web-app-status-bar-style", content="black")
    meta(http-equiv="X-UA-Compatible", content="IE=edge,chrome=1")
    title= title
    block styles
      link(rel="apple-touch-icon", href="/img/favicon.png")
      link(rel="icon",type="image/png",href="/img/favicon.png")
      link(rel='stylesheet', href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css")
      link(rel='stylesheet', href="/css/bootstrap.css")
      link(rel="stylesheet", href="/css/base.css")
    block scripts
      script(src="http://code.jquery.com/jquery.js")
      script(src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.1.3/angular.min.js")
      script(src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js")
      script(src="http://cdnjs.cloudflare.com/ajax/libs/q.js/0.9.2/q.min.js")
      script(src="js/bootstrap.js")
      script(src="js/gbe.js")
      script(src="js/app.js")
  body
    #reader(ng-app="gbe", data-ng-controller="GameBookCtrl", data-ng-init="title='#{gamebook.title}'; author='#{gamebook.author}'", ng-cloak="true")

      #heroe.slide-panel
        label Health ({{heroe.adjHealth()}} / {{heroe.adjMaxHealth()}})
        .progress: .progress-bar(ng-style="{width: heroe.healthRatio()+'%'}", ng-class="{'progress-bar-success':heroe.adjHealth() > 6, 'progress-bar-warning':heroe.adjHealth() <= 6 && heroe.adjHealth() > 2, 'progress-bar-danger':heroe.adjHealth() <= 2}")
        label Magic ({{heroe.adjMagic()}} / {{heroe.adjMaxMagic()}})
        .progress: .progress-bar.progress-bar-danger(ng-style="{width: heroe.magicRatio()+'%'}")
        label Armor ({{heroe.adjArmor()}} / {{heroe.adjMaxArmor()}})
        .progress: .progress-bar.progress-bar-info(ng-style="{width: heroe.armorRatio()+'%'}")
        hr
        h4 Skills
        ul.list-unstyled
          li(ng-repeat="(k,v) in heroe.skills") <strong>{{k}}</strong> :
            span.pull-right {{v}}
        hr
        h4 Weapons
        button.btn.btn-block.btn-primary(data-ng-repeat="at in heroe.attacks", ng-disabled="!actor.isHeroe()", ng-click="attack(at)") Attack: {{at.name}} <span class='stats'>({{at.adjustedHit()}})</span>
        hr
        h4 Spellbook
        button.btn.btn-block.btn-danger(data-ng-repeat="s in heroe.spells", data-ng-disabled="heroe.magic < s.cost || !actor.isHeroe()") Spell: {{s.name}}
        hr
        h4 Inventory
        button.btn.btn-block(data-ng-repeat="i in heroe.inventory", ng-disabled="!actor.isHeroe()", data-ng-hide="i.unit == 0", ng-class="{'btn-info':i.active}") Item: {{i.name}} ({{i.unit}})

      .book(ng-class="{wide:!scene.encounter, narrow: scene.encounter}")
        .header
          p {{title}} - {{author}}
        .content
          h5(ng-show="scene.encounter.title") {{scene.encounter.title}}
          p(ng-bind-html-unsafe="scene.render(heroe)")
          #actions(ng-show="scene.encounter")
            hr
            ul
              li(ng-repeat="a in encounter.actions") {{a}}
          hr
          btn.btn.btn-block(ng-click="choose(sel)", ng-repeat="sel in scene.selectors") {{sel.content}}

        .footer
          .alert(ng-repeat="notif in notifications") {{notif.message}}

      #encounter.slide-panel(data-ng-show='scene.encounter')
        img(ng-src="/asset/{{monster.image}}")
        hr
        label Health ({{monster.adjHealth()}} / {{monster.adjMaxHealth()}})
        .progress: .progress-bar(ng-style="{width: monster.healthRatio()+'%'}", ng-class="{'progress-bar-success':monster.adjHealth() > 6, 'progress-bar-warning':monster.adjHealth() <= 6 && monster.adjHealth() > 2, 'progress-bar-danger':monster.adjHealth() <= 2}")
        label Magic ({{monster.adjMagic()}} / {{monster.adjMaxMagic()}})
        .progress: .progress-bar.progress-bar-danger(ng-style="{width: monster.magicRatio()+'%'}")
        label Armor ({{monster.adjArmor()}} / {{monster.adjMaxArmor()}})
        .progress: .progress-bar.progress-bar-info(ng-style="{width: monster.armorRatio()+'%'}")
        hr
        h5 Encounter Actions
        button.btn.btn-block(ng-class="{'btn-success':encounter.block}", ng-click="toggleBlock()", ng-disabled="encounter.rage || !actor.isHeroe()") Block
        button.btn.btn-block(ng-class="{'btn-success':encounter.rage}", ng-click="toggleRage()", ng-disabled="encounter.block || !actor.isHeroe()") Rage
        button.btn.btn-block(ng-click="heroeRetreat()",ng-disabled="encounter.rage || !actor.isHeroe()") Retreat
        button.btn.btn-block(ng-click="heroeDiscuss()",ng-disabled="encounter.rage || !actor.isHeroe()")  Discuss
        div(ng-show="scene.encounter.state == 'won'")
          hr
          h4 Available Items
          button.btn.btn-block(ng-repeat="i in scene.encounter.treasure") {{i.description}}
        div(ng-show="scene.references")
          hr
          h4 References
          button.btn.btn-block(data-ng-repeat="r in scene.references") {{r.name}}

